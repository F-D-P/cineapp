{% extends 'peliculas/base.html' %}
{% load static %}
{% block title %}Inicio{% endblock %}

{% block content %}
<style>
  .card-hover {
    transition: transform 0.3s ease;
  }
  .card-hover:hover {
    transform: scale(1.05);
  }
</style>

<div class="container mt-4">

  <!-- ğŸ” Buscar pelÃ­cula + filtro por gÃ©nero -->
  <section class="mb-5" data-aos="fade-down">
    <h2 class="fw-semibold">Buscar pelÃ­cula</h2>
    <form method="GET" action="{% url 'inicio' %}" class="row g-3 align-items-end">
      <div class="col-md-6">
        <label for="id_q" class="form-label">TÃ­tulo, gÃ©nero o director</label>
        <input type="text" name="q" id="id_q" class="form-control" value="{{ query|default:'' }}">
      </div>
      <div class="col-md-4">
        <label for="id_genero" class="form-label">Filtrar por gÃ©nero</label>
        <select name="genero" id="id_genero" class="form-select">
          <option value="">ğŸ¬ Todos los gÃ©neros</option>
          <option value="accion" {% if genero_actual == 'accion' %}selected{% endif %}>âš¡ AcciÃ³n</option>
          <option value="comedia" {% if genero_actual == 'comedia' %}selected{% endif %}>ğŸ˜‚ Comedia</option>
          <option value="drama" {% if genero_actual == 'drama' %}selected{% endif %}>ğŸ­ Drama</option>
          <option value="terror" {% if genero_actual == 'terror' %}selected{% endif %}>ğŸ‘» Terror</option>
          <option value="aventura" {% if genero_actual == 'aventura' %}selected{% endif %}>ğŸ—ºï¸ Aventura</option>
          <option value="romance" {% if genero_actual == 'romance' %}selected{% endif %}>â¤ï¸ Romance</option>
          <option value="ciencia_ficcion" {% if genero_actual == 'ciencia_ficcion' %}selected{% endif %}>ğŸ¤– Ciencia FicciÃ³n</option>
          <option value="fantasia" {% if genero_actual == 'fantasia' %}selected{% endif %}>ğŸ§™ FantasÃ­a</option>
          <option value="documental" {% if genero_actual == 'documental' %}selected{% endif %}>ğŸ“š Documental</option>
          <option value="musical" {% if genero_actual == 'musical' %}selected{% endif %}>ğŸ¶ Musical</option>
          <option value="animacion" {% if genero_actual == 'animacion' %}selected{% endif %}>ğŸï¸ AnimaciÃ³n</option>
          <option value="suspenso" {% if genero_actual == 'suspenso' %}selected{% endif %}>ğŸ‘ï¸ Suspenso</option>
          <option value="historica" {% if genero_actual == 'historica' %}selected{% endif %}>ğŸ›ï¸ HistÃ³rica</option>
          <option value="crimen" {% if genero_actual == 'crimen' %}selected{% endif %}>ğŸ•µï¸ Crimen</option>
          <option value="misterio" {% if genero_actual == 'misterio' %}selected{% endif %}>ğŸ” Misterio</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-search"></i> Buscar
        </button>
      </div>
    </form>
  </section>

  <!-- ğŸŸï¸ Top 5 por Taquilla (Semana) -->
  <section class="mb-5" data-aos="fade-up">
    <h2 class="fw-semibold text-center">Top 5 por Taquilla (Semana)</h2>
    <div class="row">
      {% if top_taquilla %}
        {% for item in top_taquilla %}
          <div class="col-md-4 mb-4">
            <div class="card h-100 shadow card-hover">
              <div class="card-body">
                <h5 class="card-title">{{ item.funcion__pelicula__titulo }}</h5>
                <p class="card-text">
                  ğŸŸï¸ {{ item.total_vendido }} entradas vendidas esta semana
                </p>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="section-empty text-center">No hay ventas registradas esta semana.</p>
      {% endif %}
    </div>
  </section>

  <!-- ğŸï¸ CatÃ¡logo -->
  <section class="mb-5" data-aos="fade-up">
    <h2 class="fw-semibold text-center">CatÃ¡logo</h2>
    <div class="row">
      {% for pelicula in catalogo %}
        <div class="col-md-3 mb-4">
          <div class="card h-100 shadow card-hover">
            <a href="{% url 'detalle_pelicula' pelicula.id %}">
              {% if pelicula.imagen %}
                <img src="{{ pelicula.imagen.url }}" class="card-img-top" alt="{{ pelicula.titulo }}">
              {% else %}
                <img src="{% static 'img/no-image.png' %}" class="card-img-top" alt="Sin imagen">
              {% endif %}
            </a>
            <div class="card-body">
              <h6 class="card-title">{{ pelicula.titulo }}</h6>
              <p class="card-text text-muted">
                {{ pelicula.genero }} Â· 
                {% if pelicula.duracion %}
                  {{ pelicula.duracion }} min
                {% else %}
                  DuraciÃ³n no disponible
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="section-empty text-center">No hay pelÃ­culas en catÃ¡logo.</p>
      {% endfor %}
    </div>
  </section>

  <!-- ğŸ†• PrÃ³ximamente -->
  <section class="mb-5" data-aos="fade-up">
    <h2 class="fw-semibold text-center">PrÃ³ximamente</h2>
    <div class="row">
      {% for pelicula in proximamente %}
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow card-hover">
            <a href="{% url 'detalle_pelicula' pelicula.id %}">
              {% if pelicula.imagen %}
                <img src="{{ pelicula.imagen.url }}" class="card-img-top" alt="{{ pelicula.titulo }}">
              {% else %}
                <img src="{% static 'img/no-image.png' %}" class="card-img-top" alt="Sin imagen">
              {% endif %}
            </a>
            <div class="card-body">
              <h5 class="card-title">{{ pelicula.titulo }}</h5>
              <p class="card-text">
                {{ pelicula.genero }} Â· 
                {% if pelicula.duracion %}
                  {{ pelicula.duracion }} min
                {% else %}
                  DuraciÃ³n no disponible
                {% endif %}
                Â· Estrena el {{ pelicula.fecha_estreno|date:"d/m/Y" }}
              </p>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="section-empty text-center">No hay estrenos prÃ³ximos.</p>
      {% endfor %}
    </div>
  </section>

</div>
{% endblock %}
