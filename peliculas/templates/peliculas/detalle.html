{% extends 'peliculas/base.html' %}
{% load static %}
{% block title %}{{ pelicula.titulo }}{% endblock %}

{% block content %}
<div class="container mt-5" data-aos="fade-up">
  <div class="card shadow-lg">
    <div class="row g-0">
      <div class="col-md-5">
        {% if pelicula.imagen %}
          <img src="{{ pelicula.imagen.url }}" class="img-fluid rounded-start w-100 h-100 object-fit-cover" alt="{{ pelicula.titulo }}">
        {% else %}
          <img src="{% static 'img/no-image.png' %}" class="img-fluid rounded-start w-100 h-100 object-fit-cover" alt="Sin imagen">
        {% endif %}
      </div>
      <div class="col-md-7">
        <div class="card-body d-flex flex-column justify-content-between h-100">
          <div>
            <h2 class="fw-bold text-center">{{ pelicula.titulo }}</h2>
            <p class="lead"><i class="fas fa-user"></i> <strong>Director:</strong> {{ pelicula.director }}</p>
            <p><i class="fas fa-film"></i> <strong>Género:</strong> {{ pelicula.get_genero_display }}</p>
            <p><i class="fas fa-calendar-alt"></i> <strong>Estreno:</strong> {{ pelicula.fecha_estreno|date:"d/m/Y" }}</p>
            <p class="modo-invertido">
  <i class="fas fa-clock me-1"></i> <strong>Duración:</strong>
  {% if pelicula.duracion %}
    {{ pelicula.duracion }} min
  {% else %}
    No disponible
  {% endif %}
</p>
            <hr>
            <h5 class="fw-semibold">Sinopsis</h5>
            <p class="fst-italic">{{ pelicula.sinopsis }}</p>

            <!-- ⭐ Calificación -->
            <style>
              .star-rating {
                direction: rtl;
                font-size: 2rem;
                unicode-bidi: bidi-override;
                display: inline-flex;
              }
              .star-rating input {
                display: none;
              }
              .star-rating label {
                color: #ccc;
                cursor: pointer;
                transition: color 0.2s;
              }
              .star-rating input:checked ~ label,
              .star-rating label:hover,
              .star-rating label:hover ~ label {
                color: gold;
              }
              .fade-in {
                animation: fadeIn 1s ease-in-out;
              }
              @keyframes fadeIn {
                from { opacity: 0; transform: scale(0.9); }
                to { opacity: 1; transform: scale(1); }
              }
            </style>

            <h4 class="mt-4">Calificá esta película</h4>
            <form method="POST" class="d-flex align-items-center gap-3 flex-wrap">
  {% csrf_token %}
  <div class="star-rating">
    {% for i in "54321" %}
      <input type="radio" name="valor" id="star{{ i }}" value="{{ i }}">
      <label for="star{{ i }}">★</label>
    {% endfor %}
  </div>
  <button type="submit" class="btn btn-success">Enviar puntuación</button>
</form>

            {% if voto_exitoso %}
              <div class="mt-3 text-success fw-semibold fade-in">
                <i class="fas fa-check-circle"></i> ¡Gracias por tu voto!
              </div>
            {% endif %}

            {% if promedio %}
              <div class="mt-3">
                <strong>Promedio actual:</strong>
                {% for i in "12345" %}
                  {% if forloop.counter <= promedio %}
                    <span style="color: gold;">★</span>
                  {% else %}
                    <span style="color: #ccc;">★</span>
                  {% endif %}
                {% endfor %}
                <span class="text-muted">({{ promedio }} / 5)</span>
              </div>
            {% endif %}
          </div>

          <!-- Botones de acción -->
        <div class="mt-5">
          <div class="d-grid gap-3">
            <a href="{% url 'inicio' %}" class="btn btn-outline-secondary btn-lg">
              <i class="fas fa-arrow-left"></i> Atrás
            </a>

            <a href="{% url 'funciones_disponibles' pelicula.id %}" class="btn btn-outline-success btn-lg">
              <i class="fas fa-ticket-alt"></i> Ver funciones / Comprar entrada
            </a>

            {% if request.user.is_staff %}
              <a href="{% url 'editar_pelicula' pelicula.pk %}" class="btn btn-warning btn-lg">
                <i class="fas fa-edit"></i> Editar película
              </a>

              <a href="{% url 'eliminar_pelicula' pelicula.pk %}" class="btn btn-danger btn-lg">
                <i class="fas fa-trash-alt"></i> Eliminar película
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

