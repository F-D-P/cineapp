{% extends 'peliculas/base.html' %}
{% load static %}
{% block title %}Checkout{% endblock %}

{% block content %}
<div class="container mt-5" data-aos="fade-up">
  <div class="checkout-container text-center">
    <h2 class="fw-bold mb-4">Checkout de la reserva #{{ reserva.id }}</h2>

    <p><strong>Película:</strong> {{ reserva.funcion.pelicula.titulo }}</p>
    <p><strong>Función:</strong> {{ reserva.funcion.fecha|date:"d \d\e F \d\e Y" }} - {{ reserva.funcion.hora|time:"H:i" }}</p>
    <p><strong>Asientos:</strong> {{ reserva.lista_asientos }}</p>
    <p><strong>Cantidad:</strong> {{ reserva.cantidad }}</p>
    <p><strong>Estado:</strong> {{ reserva.estado }}</p>

    <hr>

    <div class="payment-method">
      <h4>Método de pago</h4>
      <p class="modo-invertido">Actualmente solo disponible con MercadoPago</p>
    </div>

    {% if preference_id %}
      <!-- Contenedor del botón de MercadoPago -->
      <div id="wallet_container" class="mp-button-wrapper mt-3">
        <p class="text-muted">Cargando botón de pago...</p>
      </div>
    {% else %}
      <div class="alert alert-danger mt-3">
        No se pudo generar el botón de pago. Intente nuevamente más tarde.
      </div>
    {% endif %}

    <a href="{% url 'inicio' %}" class="btn btn-outline-secondary mt-4">
      <i class="fas fa-arrow-left"></i> Volver
    </a>
  </div>
</div>

{% if preference_id %}
<!-- SDK de MercadoPago -->
<script src="https://sdk.mercadopago.com/js/v2"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const mp = new MercadoPago("{{ PUBLIC_KEY }}", {
      locale: "es-AR"
    });

    mp.bricks().create("wallet", "wallet_container", {
      initialization: {
        preferenceId: "{{ preference_id }}",
      },
      customization: {
        texts: {
          valueProp: 'smart_payment'
        }
      }
    });
  });
</script>
{% endif %}
{% endblock %}